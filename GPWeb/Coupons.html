<!DOCTYPE html>
<html dir="rtl" lang="ar">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round"> -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> -->
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">  -->

  <style>
    body {
      background-color: #FFEDED;
      /* background: linear-gradient(90deg, #FFC0CB 10%, #fbfdfd 90%); */

    }

    #logo {
      float: right;
      margin: 0;
      width: 5%;
      height: 5%;
    }

    #navlist {
      float: left;
    }
  </style>
  <title>القسائم الرئيسية</title>
  <link rel="shortcut icon" href="logo.png">

</head>

<body style="text-align: center;">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <img id="logo" src="logo.png">
    <h2 style="color: #1A535C;">تمكّن</h2>
    <div class="container">
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul id="navlist" class="navbar-nav me-auto mb-2 mb-lg-0">


          <li class="nav-item">
            <a href="#" style=" font-size: 14px;" class="nav-link">القسائم
              الرئيسية </a>

          </li>

          <li class="nav-item">
            <a href="Coupons.html" class="nav-link" style=" font-size: 14px;  text-decoration: underline; color: #1A535C;">جميع القسائم </a>

          </li>
          <li class="nav-item">
            <a href="" id="logout" style="padding-right: 785px ; color: red; font-size: 14px;">تسجيل الخروج </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container-xl d-flex justify-content-center align-items-center pt-3">
    <div class="input-group mb-3">
      <!-- <button class="btn btn-success" type="button" id="searchBtn">ابحث</button> -->
      <select id="option" style="color: #1A535C;" class="form-select form-select-sm"
        aria-label=".form-select-sm example">
        <option value="1" style="color: #1A535C;">مقدّم القسيمة</option>
        <option value="2" style="color: #1A535C;">رقم القسيمة</option>
      </select>
      <input type="text" class="form-control" id="searchBar" placeholder=" أدخل كلمة البحث"
        aria-label="Search using Name or Email">
    </div>
  </div>
  <h2 style="padding-top: 2%; color: #1A535C;">جميع القسائم</h2>


  <div style="text-align: center; " class="container-xl d-flex justify-content-center align-items-center p-5">
    <div style="text-align: center; " class="table-wrapper">
      <div style="text-align: center; " class="table-title">
        <div style="text-align: center; " class="row">
          <div style="text-align: center; " class="col-sm-6">
          </div>
        </div>
      </div>
      <table id="t" class="table table-striped table-hover">
        <tr class="hovertr">
        <tr class="hovertr">

          <td style="color: #1A535C;">اسم القسيمة</td>
          <td style="color: #1A535C;"> تاريخ الانتهاء</td>
          <td style="color: #1A535C;"> المالك</td>
          <td style="color: #1A535C;"> رقم القسيمة</td>
          <td style="color: #1A535C;">الإجراء</td>

        </tr>

        <tbody id="tbody"></tbody>
      </table>



      <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
      <script >

      </script>
      <script type="module" id="MainScript">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-analytics.js";
        import { getFirestore, collection, getDocs, getDoc, addDoc } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-firestore.js";
        import { doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-auth.js";
        // import { useCollection } from 'react-firebase-hooks/firestore.js';
        import { getDatabase } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-database.js";
        const firebaseConfig = {
          apiKey: "AIzaSyCYFqGVcdgYTcvQUTwQ5Bk-TeJxJXUBBF0",
          authDomain: "tamakan-ef69b.firebaseapp.com",
          projectId: "tamakan-ef69b",
          storageBucket: "tamakan-ef69b.appspot.com",
          messagingSenderId: "40014765527",
          appId: "1:40014765527:web:5a98a37b282a17eb65ff92",
          measurementId: "G-MKK3N5RPLG"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);



        var users = [];


        firebase.initializeApp(firebaseConfig);
        let db = firebase.firestore();


        function realtimeChanges() {

          db.collection('coupon').onSnapshot((querySnapshot) => {

            querySnapshot.forEach(doc => {
              users.push(doc.data());
              const db1 = getFirestore(app);

              addAllCouponsItemToTable(users,db1);

            });
          });

        }

        var tbody = document.getElementById('tbody');

        function addCouponItemToTable(name, endDate, childID, couponID,db1) {


          var trow = document.createElement('tr');



          //var td1 = document.createElement('td');
          var td2 = document.createElement('td');
          var td3 = document.createElement('td');
          var td4 = document.createElement('td');
          var td5 = document.createElement('td');
          var td6 = document.createElement('td');
          var td7 = document.createElement('td');


          // const img = new Image(100, 200); // width, height
          // img.src = "https://picsum.photos/200/301";
          // document.appendChild(img);

          td2.innerHTML = name;
          td4.innerHTML = endDate.toDate().toDateString();
          td5.innerHTML = childID;
          td6.innerHTML = couponID;
          // td7.innerHTML = "<button class=" + "DeleteButton" + ">delete</button>";
          //td1.innerHTML = 'عدد الأعضاء: '+acceptedCount+'<br>'+'السهم: '+amount+'<br>'+startDate.toDate()+' :تاريخ البدء '+'<br>'+id +' :رقم المجموعة '+'<br>';// + 'الاعضاء: '+maxMembers;





          //trow.appendChild(td1);
          trow.appendChild(td2);
          trow.appendChild(td4);
          trow.appendChild(td5);
          trow.appendChild(td6);
          // trow.appendChild(td7);

          tbody.appendChild(trow);


          //  get catogeries and add it to list-group
          const couponsRef = collection(db1, "coupon");
          (async () => {
            const couponsSnapshot = await getDocs(couponsRef);
            couponsSnapshot.forEach((docx) => {
              console.log(docx.name, " => ", docx.data());
              //get button 
              // add action if delete icon clicked
              // td7.addEventListener('click', function () {
              //   console.log("delete clicked");
              //   console.log(docx.name);
              //   // delete from firestore
              //   const docRef = doc(db1, "couponType", docx.name);
              //   deleteDoc(docRef).then(() => {
              //     console.log("Document successfully deleted!");
              //     location.reload();
              //     alert("تمت عملية حذف القسيمة بنجاح");
              //   }).catch((error) => {
              //     // The document probably doesn't exist.
              //     console.error("Error removing document: ", error);
              //   });
              // });

            });
          })();
        }



        function addAllCouponsItemToTable(couponDocsList , db1) {

          tbody.innerHTML = '';
          couponDocsList.forEach(element => {

            addCouponItemToTable(element.name,element.endDate, element.childID, element.couponID,db1);
          });
      }

        window.onload = realtimeChanges;
      </script>
      <script>
            //         $('#addCategory').click(function () {
            //       $('#addCategoryModal').modal('show');
            // });
            // const addCategoryButton = document.getElementById('addCategoryButton');
            // addCategoryButton.addEventListener('click', async (e) => {

            //       const categoryName = document.getElementById('categoryName').value;
            //       if (categoryName == "") {
            //             $('#emptyCategoryNameModal').modal('show');
            //       } else {
            //             const docRef = await addDoc(collection(db, "categories"), {
            //                   name: categoryName,
            //                   isDeleted: false
            //             });
            //             console.log("Document written with ID: ", docRef.id);

            //             location.reload();
            //             alert("لقد تمت عملية إضافة قسم بنجاح");
            //       }

            //       $('#addCategoryModal').modal('hide');
            //       document.getElementById('categoryName').value = '';

            // });














      </script>


      <script type="module">

        document.getElementById("logout").addEventListener('click', function () {
          signOut(auth).then(() => {
            // Sign-out successful.
            if (confirm("هل أنت متأكد من رغبتك في تسجيل الخروج؟")) {
              location.replace("login.html");
            }

          }).catch((error) => {
            console.log('Error singing in, ', error.message);
            alert("حدث خطأ!! حاول مرة اخرى");
          });

        });


        // Initialize Cloud Firestore and get a reference to the service
        //    const db1 = getFirestore(app);

        // //  get catogeries and add it to list-group
        // const couponsRef = collection(db1, "couponType");
        // const couponsList = document.querySelector(".list-group");
        // const deleteIcon = document.getElementById("DeleteButton");
        // (async () => {
        //   const couponsSnapshot = await getDocs(couponsRef);
        //   couponsSnapshot.forEach((docx) => {
        //     console.log(docx.name, " => ", docx.data());
        //     //get button 
        //     // add action if delete icon clicked
        //     deleteIcon.addEventListener('click', function () {
        //       console.log("delete clicked");
        //       console.log(docx.name);
        //       // delete from firestore
        //       const docRef = doc(db1, "couponType", docx.name);
        //       deleteDoc(docRef).then(() => {
        //         console.log("Document successfully deleted!");
        //         location.reload();
        //         alert("تمت عملية حذف القسيمة بنجاح");
        //       }).catch((error) => {
        //         // The document probably doesn't exist.
        //         console.error("Error removing document: ", error);
        //       });
        //     });

        //   });
        // })();







        searchBar.onkeyup = function searchData() {

          var searchBtn = document.getElementById('searchBtn');
          var searchBar = document.getElementById('searchBar');

          var filter = searchBar.value.toUpperCase();
          var tbody = document.getElementById('t');
          var tr = tbody.getElementsByTagName('tr');
          var category = document.getElementById('option');


          for (let i = 0; i < tr.length; i++) {
            if (category.options.selectedIndex == 1) {
              var td = tr[i].getElementsByTagName('td')[0];
            }
            else {
              var td = tr[i].getElementsByTagName('td')[4];
            }

            console.log(td);
            if (td) {
              let textValue = td.textContent || td.innerHTML;

              if (textValue.toUpperCase().indexOf(filter) > -1) {
                tr[i].style.display = '';
              }
              else {
                tr[i].style.display = 'none';
              }
            }
          }
        }


      </script>
</body>

</html>